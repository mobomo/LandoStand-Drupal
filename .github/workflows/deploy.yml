on:
  workflow_dispatch:
  schedule:
    - cron: '0 6 * * *'  # Nightly at 6 AM

jobs:
  build-and-deploy-nightly:
    runs-on: turing-rk1-ubuntu
    container:
      image: mobomo/drupalstand-ci:8.0-latest
    steps:
      - uses: actions/checkout@v4
      - name: Install composer requirements
        run: composer install
      - name: Install GRC
        run: |
          apk add py-pip
          pip install git-remote-codecommit
      - name: Push nightly tag to CodeCommit
        run: |
          vendor/bin/blt artifact:deploy \
            --environment ci \
            --commit-msg "Nightly Build - ${{ github.run_number }}" \
            --branch "nightly-build" \
            --tag "0.0.${{ github.run_number }}" \
            --ignore-dirty \
            --no-interaction \
            --verbose